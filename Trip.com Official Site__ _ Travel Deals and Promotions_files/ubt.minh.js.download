(()=>{ window.UBT_LOADTIMES = (window.UBT_LOADTIMES||0) + 1;if(window.UBT_LOADTIMES >1){console.log("UBT_LOADTIMES:"+window.UBT_LOADTIMES);return;}"use strict";var e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{mP:()=>V,xs:()=>F,Gm:()=>j,mB:()=>D,SK:()=>z,EO:()=>K,Jg:()=>G,vM:()=>q,QP:()=>$});const i={client:{},webClient:{},miniAppClient:{},mini:{},clientType:"",clientInfo:{},watcher:{}};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}function s(e,t,i){return(t=r(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let o=function(e){return e.PV="pv",e.ACTION="action",e.METRIC="metric",e.MONITOR="monitor",e.TRACE="trace",e.DEV_TRACE="dev_trace",e.PRIVATE_TRACE="private_trace",e.ERROR="error",e.USER_BLOCK="user_block",e.EXPOSURE="exposure",e}({});function a(e,t){return"send"==t}const l=class{constructor(){s(this,"watchingMap",new Map),s(this,"triggeredMap",new Map)}watch(e,t){if(t=Array.isArray(t)?t:[t],this.triggeredMap.has(e)){let i=this.triggeredMap.get(e);if(t.forEach((e=>e.apply(this,i))),0===(t=t.filter((e=>!0===e.prototype.watch))).length)return}if(this.watchingMap.has(e)){let i=this.watchingMap.get(e)||[];i.push(...t),this.watchingMap.set(e,i)}else this.watchingMap.set(e,t)}trigger(...e){let t=Array.prototype.shift.call(arguments),i=this.watchingMap.get(t);if(this.triggeredMap.set(t,arguments),!i||0===i.length)return!1;for(let e,t=0;e=i[t++];)e.apply(this,arguments);i=i.filter((e=>!0===e.prototype.watch)),0===i.length?this.watchingMap.delete(t):this.watchingMap.set(t,i)}getTriggeredVal(e){if(this.triggeredMap.has(e)){let t=this.triggeredMap.get(e);if(null!=t)return Array.from(t)[0]}return null}remove(e,t){}};class c{static printInfo(e){console.info(`[UBT INFO] ${e}`)}static printWarn(e){console.warn(`[UBT WARNING] ${e}`)}static printError(e,t){console.error(`[UBT ERROR] ${e}`,t)}static reportReqFail(e,t){Ie.send({type:o.DEV_TRACE,key:"bbz_ubt_req_fail",data:e},t)}static reportError(e,t,i){try{t instanceof u||console.error(`[UBT ERROR] ${e}`,t),c.errStacks.push(t.stack);let n=c.errStacks.length;n>c.ERR_STACK_SIZE&&(c.errStacks=c.errStacks.slice(n-c.ERR_STACK_SIZE,n));let r="ExceptionError";t instanceof d?r="ValidationError":t instanceof u&&(r="IgnorableError"),c.errStacks.filter((e=>e==t.stack)).length>=c.LOOP_LIMIT_MAX||Ie.send({type:o.DEV_TRACE,key:"bbz_ubt_logerr",data:{name:e||(null==t?void 0:t.name),stack:null==t?void 0:t.stack,message:`${e}-${null==t?void 0:t.message}`,errType:r}},i)}catch(e){c.printError("reportError error.",t)}}static sendErrorUbt(e,t,n){var r;let s={from:"framework",catcher:`auto_${U.version}_${t}`,by:"ubt_sdk_listener",...null==e?void 0:e.extendedField};"mini"==i.clientType&&(s.appId=i.mini.mcdAppId),Ie.send({type:o.ERROR,data:{...e,category:i.client.errCategory,framework:(null===(r=i.webClient)||void 0===r||null===(r=r.clientInfo)||void 0===r?void 0:r.framework)||"normal",extendedField:s}},n,{force:!0})}}s(c,"LOOP_LIMIT_MAX",5),s(c,"ERR_STACK_SIZE",10),s(c,"errStacks",[]),s(c,"checkConfig",null),s(c,"checkId","");class d extends Error{constructor(e){super(e)}}class u extends Error{constructor(e){super(e)}}const p="UBT_LASTVIEW",h="UBT_BFA",f="UBTPending",g="UBTActive",m="_bfa",v="UBT_VID",w="UBT_DESERTED",_="UBT_UNHANDLED",y="UBT_MAGNET",b="UBT_CID",I="UBT_CONFIG",T={get BFA(){return/^1\.\d+\..{3,12}\.1\.\d+\.\d+\.\d+\.\d+\..+$/},get VID(){return/^\d{10,13}\.[a-zA-Z0-9]{3,12}$/},get UBT_LSKEY(){return new RegExp("^"+f+"_(.+)$")},get UBTACTIVE_LSKEY(){return new RegExp("^"+g+"_.+$","g")},get UBTC(){return/^ubtc_([a-zA-Z](_?[a-zA-Z0-9]{1,20}){0,3})$/},get PAGE_ID(){return/^[a-zA-Z0-9_]{1,50}$/},get PAYSITE_HOST(){return/secure\.c?trip\.com/},TEST_ENV:/(\.qa\.nt\.)|(\.test\.wingontravel\.)|(localhost|172\.16|127\.0|10\.15|10\.32)|(\.uat\.)|(\.fws\.)|(\.fat\d*\.)|(\.tripqate\.)|(\.(beta|dev)\.qunar\.)/i,TRIP:/\.trip/gi,INTRANET:/\.ctripcorp\./gi,MOBILE:/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i,TRIP_APP:/(ibuctrip)|(trip\.com_ctripwireless)/i,TRAVIX:/\.travix\./gi,CTRIP_APP:/ctripwireless/i},S=3456e7,E=18e5,C=3e5,R="before_page_ready",A=["http://wwwteaflight.beta.qunar.com","http://mteaflight.beta.qunar.com","https://www.teaflight.com","https://m.teaflight.com"];var k,O,P;const B=null===(k="1.3.62             ")?void 0:k.replace(/(\s*$)/,""),M=null===(O="73226/25733        ")?void 0:O.replace(/(\s*$)/,""),L={enterTs:Date.now(),instMap:new Map,instKeys:[],curInst:null,bfrInst:null,version:B,summary:{resouceSize:parseInt(M.split("/")[0])||0,gzipSize:parseInt(M.split("/")[1])||0},setInst:function(e,t){try{if(t.instKey==R)return void(this.bfrInst=t);if(this.instKeys.push(e),L.curInst=t,L.instMap.size>=5){let e=L.instMap.keys().next().value;L.instMap.delete(e)}L.instMap.set(e,t)}catch(e){c.printError("setInst err.",e)}},registerTime:0,curPv:void 0,blockPingTimes:0},N=L.summary;N.tag={sdkVersion:L.version,npmVersion:(null===(P=L.ubtCom)||void 0===P?void 0:P.version)||""};const U=L,x={repeatErrorDuration:6e4,multiSendIntervalTime:1e3,logReportIt:2e3,multiSendMaxCount:50,fpVersion:"*",tcpSwitch:!1,processChunkCount:20,requestConcurrenceMaxCount:20,mpStoreMaxCount:50,storageMaxSize:2097152,pvReadyWaitTime:500,ssb:[]};function D(e,t){return null==e?0:("number"==typeof e&&(e=e.toString()),parseInt(e,t))}function $(e){switch(Object.prototype.toString.call(e)){case"[object Number]":return isNaN(e)?Ee.NaN:Ee.Number;case"[object Boolean]":return Ee.Boolean;case"[object String]":return Ee.String;case"[object Array]":return Ee.Array;case"[object Object]":return Ee.Object;case"[object Undefined]":return Ee.Undefined;case"[object RegExp]":return Ee.RegExp;case"[object Error]":return Ee.Error;case"[object Function]":return Ee.Function;default:return Ee.Unknown}}function V(e,t=null){try{if(!e)return t;let i=JSON.parse(e);return t&&Object.prototype.toString.call(t)!=Object.prototype.toString.call(i)?t:i}catch(e){return t}}function K(){return(new Date).toLocaleDateString("zh-cn").replace(/\//g,"")}function j(e,t){try{if(!e||!t)return-1;let i=e.split("."),n=t.split(".");for(let e=0;e<=2;e++){let t=(i[e].match(/^\d+/g)||[])[0]||0,r=(n[e].match(/^\d+/g)||[])[0]||0;if(t>r)return 1;if(t<r)return-1}return 0}catch(e){return-1}}const F={DECODE:1,MAP:2,JSONPARSE:3};function q(e,t=0){return null==e||null==e?null:((t&F.DECODE)==F.DECODE&&(e=decodeURIComponent(e||"")),(t&F.MAP)==F.MAP&&(e=function(e){let t={},i=e.split("&")||[];for(let e=0;e<i.length;e++){let n=i[e].split("=");n.length>1&&(t[n[0]]=n[1])}return t||{}}(e)),(t&F.JSONPARSE)==F.JSONPARSE&&(e=V(e)),e)}function z(e,t,i,n,r){!function s(){try{let o=0;if(e&&e.length>0){let n=e[0];for(;n&&o<=t;)i(n),o++,e.shift(),n=e[0]}r&&r(),e&&e.length>0?setTimeout((()=>{s()}),0):n&&n()}catch(e){}}()}const G=e=>{if(e.isProd)return"PRO";if(e.isUat)return"UAT";if("undefined"==typeof window)return"";let t=window.location.host;return t?t.match(/^m\.ctrip\.com/i)?"PRO":t.match(/\.uat\.qa/i)||t.match(/(\.|-)uat\.ctripqa\.com/i)?"UAT":t.match(/\.ui\.|\.dev\.|\.fat/i)||t.match(/\.faas\.qa/i)||t.match(/\.lpt/i)||t.match(/\.fws/i)?"FAT":t.match(/^(localhost|172\.16|127\.0|10\.15|10\.32)/i)?"DEV":"":""},J={context:["pid","vid","sid","pvid","version","appId","deviceImei","deviceMac","env","clientId","url","fromPage","fromPvid","fromSid","screenWidth","screenHeight","cookieLength","cookieCount","storageLength","lang","engine","referrer","appInfo","devicePixelRatio","other","idc","rid","fp","ffp","trafficSource","newVisitor","newSession","agent","ua"],user:["userId","abTest","corpid","duid"],business:["allianceId","allianceSid","allianceOuid","allianceCreateTime","sourceId","orderId","productId","innerOuId","innerSid","pushCode","attrs"],ubtList:["seq","triggerTs","type","subType","data"]},W={[o.ERROR]:"error",[o.USER_BLOCK]:"ub",[o.TRACE]:"tiled_tl",[o.DEV_TRACE]:"tiled_tl",[o.PRIVATE_TRACE]:"pr_t"},X=function(){let e="";return function(t){return e||(e=t.isTravix?t.isProd?Q():"//m.fws.trip.travix.com":t.isProd?t.isTrip?"https://www.trip.com":t.isLAN?"//apigateway.ctripcorp.com":t.isIPV6?"//upgrade-m.ctrip.com":"//m.ctrip.com":"//gateway.m.fws.qa.nt.ctripcorp.com")}}(),Q=()=>{try{let e=location.hostname,t=/^www\.(.+)/,i=e.match(t),n=e;return n=i?i[1]:e.split(".").slice(1).join("."),"//rest."+n}catch(e){return c.reportError("getTravixGateWay err.",e),""}};function H(e,t){return e.isTravix?e.isProd?"//ubt-sgp.travix.com":"//s.fws.trip.travix.com":t||!e.isProd?"//s.uat.qa.nt.ctripcorp.com":e.isLAN?"//ubt.fx.ctripcorp.com":e.isTrip?"//ubt-sgp.trip.com":"//s.c-ctrip.com"}function Y(e){return e.isProd?e.isTrip?"//webresource.tripcdn.com":"//webresource.c-ctrip.com":e.isTrip?"//webresource.english.uat.qa.nt.ctripcorp.com":"//webresource.uat.qa.nt.ctripcorp.com"}function Z(e){return e.isProd?"//static-assets.travix.com/packages":"//static.assets.uat.trip.travix.com/packages"}function ee(e,t=!1){return!e.isFile&&"mini"!=e.clientType&&!e.isTravix||t?"":"https:"}function te(e){const t=X(e);return`${ee(e,t.indexOf("http")>=0)}${t}/restapi/soa2/18088/getAppConfig.json`}function ie(e){let t=ee(e);const i=X(e);return e.isTravix?`${t}${i}/restapi/soa2/10290/createClientId`:`${t}${i}/restapi/soa2/12538/createClientId`}function ne(e,t,i){return`https:${H(e,t)}/bf.gif`}const re=function(){let e=16384,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";return function(i){let n=[];i=unescape(encodeURIComponent(i));for(let e=0;e<i.length;e++)n.push(i.charCodeAt(e));return function(i){let n=[],r=[],s=-1,o=0,a=0,l=0,c=0,d=[];v(19);let u=0;for(;u<i.length&&a<i.length;u+=e)u>0&&(r=r.slice(e)),p();return-1!=s&&m(),2==c?w(l<<4&63):4==c&&w(l<<2&63),d.join("");function p(){let t=h(u+32768,i.length),l=h(t,i.length-3+1);for(;a<t;a++){let t=0,i=0;if(a<l){let s=f();if(a>=o){let o=n[s]-1;for(;130!=t&&o>=0&&o>=a-e;){let e=g(o);e>=3&&e>t&&(t=e,i=a-o-t),o=r[o-u]}}r[a-u]=n[s]-1,n[s]=a+1}if(t>=3){for(o=a+t,-1!=s&&(m(),s=-1),v(t-3);i>127;)v(127&i|128),i>>=7;v(i)}else a>=o&&-1==s&&(s=a)}}function h(e,t){return Math.min(e,t)}function f(){let e=0;for(let t=a;t<a+3;t++)e*=16777619,e^=i[t];return 16383&e}function g(e){let t,n,r=h(e+130,a);for(t=e,n=a;t<r&&n<i.length&&i[t]==i[n];t++,n++);return t-e}function m(){for(let e=s;e<a;e+=127){let t=h(127,a-e);v(255&-t);for(let n=e;n<a&&n<e+t;n++)v(i[n])}}function v(e){let t=l<<6-c;l=255&e,c+=2,t|=l>>c,w(63&t),c>=6&&(c-=6,t=l>>c,w(63&t))}function w(e){d.push(t.charAt(e))}}(n)}}(),se="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function oe(e){try{let n=Math.random().toString(16).slice(-4);if(e<=4)return n.slice(0,e);let r="";for(var t=0;t<e-n.length;t++){var i=Math.ceil(61*Math.random());r+=se[i]}return n+r}catch(e){console.error("genRandomStr error.",e)}}async function ae(e,t,n,r){let s=JSON.stringify({d:e}),o=function(e,t){var i;return null!==(i=window)&&void 0!==i&&i.bizCustomCollectUrl&&A.some((e=>{var t;return null===(t=window.bizCustomCollectUrl)||void 0===t?void 0:t.startsWith(e)}))?window.bizCustomCollectUrl:`https:${H(e,t)}/bee/collect`}(i.clientInfo,t);try{if(!n&&"web"==i.client.clientType&&i.webClient.shoudleSendBeacon(r)&&U.blockPingTimes<2)return i.client.reportBySendBeacon(s,o,n)}catch(e){i.clientInfo.isSupportSendBeacon=!1}return(await i.client.request({body:s,url:o},1e4,void 0,n)).success?{success:!0}:{success:!1,message:"postReport Faild."}}async function le(e,t,n,r){let s,a,l,d,u=Date.now(),p=U.version;try{var h;var f;if(e.business.attrs.ubt_reqid=u.toString()+oe(6),r&&(e.business.attrs.ubt_batchid=r,e.ubtList.forEach((e=>{let t=e.data;if(t)switch(e.type){case o.TRACE:case o.DEV_TRACE:t.val&&(t.val.ubt_batchid=r);break;case o.EXPOSURE:t.ubt_batchid=r}}))),e.ubtList.find((e=>e.type==o.PV)))"single"==t&&(t="multi"),d={metaSender:p,contextTs:u.toString(),vid:e.context.vid,sid:e.context.sid.toString(),pvId:e.context.pvid.toString(),appId:null===(f=e.context.appId)||void 0===f?void 0:f.toString()},s={backup:{req:e,type:t,isMagnetSend:n},headers:{...d},ts:u};else delete e.business.attrs.init_cki;let c=function(e){let t={};for(const i in e){let n=[],r=e[i],s=J[i];s?(Array.isArray(r)?r.forEach((e=>{let t=[];s.forEach(((i,n)=>{t[n]=e[i]})),n.push(t)})):s.forEach(((e,t)=>{n[t]=r[e]})),t[i]=n):t[i]=r}return t}(e);if(c.sendTs=u,"tcp"==t&&i.client.reportByTcp)return i.client.reportByTcp(c,d?{headers:{...d},ts:u}:void 0);!n&&i.client.reportMagenet&&i.client.reportMagenet((()=>{le(e,t,!0)})),a=`d=${re(JSON.stringify(c))}&ac=b`,l=`f00${c.sendTs}!m1Legacy!${a}`;let g="single"==t&&(null===(h=e.ubtList[0])||void 0===h?void 0:h.isSendBeacon);return"single"!=t||g?ae(l,n,d?{headers:{...d},ts:u}:void 0,g):async function(e,t,n){return await i.client.imgRequest({body:e,headers:{"Content-Type":"image/gif"},url:ne(i.clientInfo,t)},void 0,n)}(a,n,d?{headers:{...d},ts:u}:void 0)}catch(e){return c.printError("send error.",e),{success:!1,message:null==e?void 0:e.message}}}class ce{static getIntance(){return this._instance||(this._instance=new ce),this._instance}constructor(){this.pendingSendQ=new Map,this.sendingCount=0}push(e,t){try{return this.send(e,t),!0}catch(t){return c.reportError("singleSender push error.",t,e.instKey),!1}}async send(e,t,i=!1){let n=`${e.instKey}_${t.seq}`;if(this.sendingCount>=x.requestConcurrenceMaxCount&&!i)return this.pendingSendQ.set(n,[e,t]),!0;this.pendingSendQ.has(n)&&this.pendingSendQ.delete(n),this.sendingCount++;let r=await le({ubtList:[t],...e.getCommon()},"single");return this.completeSend(e,t,r),r.success}async completeSend(e,t,i){this.sendingCount--,t.type==o.PV&&null!=i&&i.success&&(e.pvSend=!0);let n=Array.from(this.pendingSendQ.values())[0];if(n){const[e,t]=n;await this.send(e,t,!0)}}start(){}close(){}restart(){}}const de=ce,{mP:ue}=t,pe="pv";class he{static getIntance(){return this._instance||(this._instance=new he),this._instance}constructor(){this.sendingKeys=new Set}push(e,t){try{let n=t.type==o.PV;if(!i.client.checkLsPush()||!1===t.isMultiSend)return de.getIntance().push(e,t);let r=e.instKey,s=e.getCommon(),a=`${f}_${r}`,l=n?pe:t.seq+"",c=i.client.getLs(a,!0);if(c&&c.ubts?c.ubts[l]=t:c={common:s,ubts:{[l]:t}},n||Object.keys(c.ubts||{}).length>=x.multiSendMaxCount)Object.keys(c.ubts||{}).forEach((e=>{this.sendingKeys.add(`${a}_${e}`)})),this.send(new Map([[a,c]]));else{let e=JSON.stringify(c);i.client.setLs(a,e)}return!0}catch(t){return c.reportError("multiSender push error.",t,e.instKey),!1}}beforeSend(e,t){if(!e||!t||0==t.length)return;let n=i.client.getLs(e,!0);if(n){let r=n.ubts||{};t.forEach((e=>{delete r[e]})),0==Object.keys(r).length?i.client.removeLs(e):i.client.setLs(e,JSON.stringify(n))}}completeSend(e,t){e&&t&&0!=t.length&&t.forEach((t=>{if(this.sendingKeys.delete(`${e}_${t}`),t==pe){let t=e.split("_")[1],i=U.instMap.get(t);i&&(i.pvSend=!0)}}))}getNextSendingItems(){let e=new Map,t=oe(4);try{let n=0,r=!1;return i.client.iterateLsKeys((t=>{if(!t||!T.UBT_LSKEY.test(t))return;let s=(t.match(T.UBT_LSKEY)||[])[1];if(s!==R&&!U.instKeys.includes(s)){const e=Date.now(),t=i.client.getLs(`${g}_${s}`);if(t&&!isNaN(Number(t))&&e-Number(t)<2e3)return}let o=ue(i.client.getLs(t)),a=(null==o?void 0:o.ubts)||{};o&&a&&0!=Object.keys(a).length||i.client.removeLs(t);let l={};if(!r)for(const e in a){if(n>=x.multiSendMaxCount)break;this.sendingKeys.has(`${t}_${e}`)||(this.sendingKeys.add(`${t}_${e}`),l[e]=a[e],e!=pe&&(r=!0,n++))}!(pe in a)||pe in l||this.sendingKeys.has(`${t}_${pe}`)||(this.sendingKeys.add(`${t}_${pe}`),l[pe]=a[pe]),Object.keys(l).length>0&&e.set(t,{common:o.common,ubts:l})})),{data:e,batchId:t}}catch(e){return c.reportError("getNextSendingItems error.",e),null}}async send(e,t){let i=[];return e.forEach(((e,t)=>{let n=e.ubts||{};pe in n&&(i.push({lsKey:t,subKeys:[pe],request:{...e.common,ubtList:[n[pe]]}}),delete n[pe]),Object.keys(n).length>0&&i.push({lsKey:t,subKeys:Object.keys(n),request:{...e.common,ubtList:Object.values(n)}})})),await Promise.all(i.map((async({lsKey:e,subKeys:i,request:n})=>{this.beforeSend(e,i);let r=await le(n,"multi",!1,t);r&&r.success&&this.completeSend(e,i)}))),!0}scheduleSend(){try{let e=this.getNextSendingItems();return null!=e&&e.data&&e.data.size>0&&this.send(e.data,e.batchId),this.scheduleSend.bind(this)}catch(e){c.reportError("scheduleSend error.",e)}}start(e){if(!i.clientInfo.isSupportLS)return!1;if("web"==i.clientType){let t=`${g}_${e}`;i.webClient.setLs(t,String(Date.now())),setInterval((()=>{i.webClient.setLs(t,String(Date.now()))}),2e3)}return null!=this.timer||(this.timer=setInterval(this.scheduleSend.call(this),x.multiSendIntervalTime)),!0}}const fe=he;class ge{constructor(e,t="cookie"){if(e&&(Object.keys(e).forEach((t=>{this[t]=e[t]})),e.vid&&!e.id)){let t=e.vid.split(".");this.vid_ts=parseInt(t[0]),this.id=t[1]}Object.defineProperties(this,{from:{value:t,enumerable:!1,writable:!1}})}genBfaVal(){return`1.${this.vid_ts}.${this.id}.1.${this.lastSession_ts}.${this.session_ts}.${this.sid}.${this.pvid}.${this.pageId||0}`}genKey(){return`${this.vid||this.genVid()}_${this.sid}_${this.pvid}`}genVid(){return this.vid?this.vid:this.vid_ts&&this.id?this.vid=`${this.vid_ts}.${this.id}`:void 0}static parse(e,t="cookie"){let i;try{if(!e)return new ge;if("cookie"==t){let t=e.split(".")||[];T.BFA.test(e)&&t.length>6&&(i={vid_ts:parseInt(t[1]),id:t[2],lastSession_ts:parseInt(t[4]),session_ts:parseInt(t[5]),sid:parseInt(t[6]),pvid:parseInt(t[7]),pageId:t[8]})}else{let t=V(e,{});t.vid&&t.sid&&t.pvid&&(i=t)}let n=new ge(i,t);return n.genVid(),n.type=t,n}catch(e){return c.reportError("BFA parse error.",e),new ge}}}const me=ge;const ve=class{constructor(e){try{var t,n;i.client.refreshClientEnv(),this.props=e,Ae.ubtPropsCheck(e),this.cacheGroupKey=e.cacheGroupKey,this.appId=e.appId,"web"==i.client.clientType&&window.__CSR_MP_AppID__&&(this.appId=window.__CSR_MP_AppID__),this.business=e.business||{},this.pageId=this.verifyPageId(e.pageId,this.business),this.initSettings(e.settings),this.isTimeout4waitingFields=!1,this.reportedErrorSet=new Set,this.pendingQueue=[],this.beginTs=e.registerTs||Date.now(),this.nextSeqNum=1,this.instKey=e.instKey,N.tag.pageRef=this.instKey;const r=null===(t=i.client)||void 0===t||null===(t=t.miniEnv)||void 0===t?void 0:t.miniType;this.sender="alipay"===r?de.getIntance():i.clientInfo.isSupportLS&&this.sendSetting.isMultiSend||null!==(n=window)&&void 0!==n&&n.bizCustomCollectUrl?fe.getIntance():de.getIntance(),this.init(!0),i.client.handleAfterRegister&&i.client.handleAfterRegister(this),Ie.handleBfRegisterReq(this.instKey),this.readyCheck()}catch(e){var r;this.initInstFailed=!0,c.printError("init error.",e),this.clearErrorTimer&&clearInterval(this.clearErrorTimer),null!==(r=this.sender)&&void 0!==r&&r.timer&&clearInterval(this.sender.timer)}}initSettings(e){var t,i,n,r;e=e||{},this.sendSetting={waitingFields:null!==(t=e.waitingFields)&&void 0!==t?t:[],isMultiSend:null===(i=e.isMultiSend)||void 0===i||i,waitingTimes:null!==(n=e.waitingTimes)&&void 0!==n?n:1e4,bizTokenKeys:null!==(r=e.bizTokenKeys)&&void 0!==r?r:[],urlMaxLength:e.urlMaxLength||600,referrerMaxLength:e.referrerMaxLength||500,abTestMaxLength:e.abTestMaxLength||512}}verifyPageId(e,t){return e&&!T.PAGE_ID.test(e)?(c.printError("PageId is invalid. PageId must contain a maximum of 50 uppercase and lowercase letters, digits, or underscores."),t.invalidPageId=e,"default_pageId"):e}refreshPv(){this.beginTs=Date.now(),this.init(!1)}init(e=!0){this.setBfa(!0),this.setCommon(),this.instKey||(this.instKey=this.genInstKey()),U.setInst(this.instKey,this),e&&this.initOnlyOnce(),this.send({type:o.PV},this.beginTs),this.sendFPMetric()}initOnlyOnce(){this.startClearErrorTimer(),this.sendSetting.waitingFields&&this.sendSetting.waitingFields.length>0&&setTimeout((()=>{this.isTimeout4waitingFields=!0,this.readyCheck()}),this.sendSetting.waitingTimes),this.sender.start(this.instKey)}startClearErrorTimer(){try{this.clearErrorTimer&&clearInterval(this.clearErrorTimer),this.clearErrorTimer=setInterval((()=>{this.reportedErrorSet.clear()}),x.repeatErrorDuration)}catch(e){c.reportError("startClearErrorTimer error.",e,this.instKey)}}genInstKey(){let e=this.common.context.vid.split(".")[1];return`${this.beginTs}_${e}`}get seqNum_autoAdd(){return this.nextSeqNum++}set(e,t){try{let{pageId:t,...n}=e;if(t){let e=this.verifyPageId(t,this.business);this.pageId=this.bfa.pageId=this.common.context.pid=e,i.client.writeBfa(this)}return Object.assign(this.business,n),this.bindBiz2Common(),this.readyCheck(),{success:!0,readyStatus:this.readyStatus}}catch(e){return c.reportError("UBT.set error.",e,this.instKey),{success:!1,message:null==e?void 0:e.message}}}send(e,t,n,r){try{var s;if(!e)throw new d("send request is empty !");t=t||(new Date).getTime(),Ae.transMetricIfBizError(e);let{type:a,data:l}=e;if(i.client.distinctErr&&Ae.isUbtErrorData(a,l)&&this.isRepeatError(l))return{success:!1,message:"error repeat."};i.client.appendReqDataBeforeStringify(e),Ae.stringifySendData(e),Ae.validateSendRequest(e),x.ssb.includes(null===(s=e.key)||void 0===s?void 0:s.toString())&&(n=!1,r=!0);let c={seq:this.seqNum_autoAdd,type:a==o.USER_BLOCK?o.ERROR:a,subType:W[a],data:Ae.transformUbtData(e),triggerTs:t,isMultiSend:n,isSendBeacon:r};return this.pendingQueue.push(c),this.readyCheck(),{success:!0,readyStatus:this.readyStatus}}catch(e){return c.reportError("send error.",null==e?void 0:e.message,this.instKey),{success:!1,message:null==e?void 0:e.message}}}getCommon(){return JSON.parse(JSON.stringify(this.common))}readyCheck(){let e=!0;if(this.pageId){if(!this.readyStatus&&!this.isTimeout4waitingFields){let t=Array.from(new Set([...this.sendSetting.waitingFields||[]]));for(let i=0;i<t.length;i++){const n=t[i];if(void 0===this.business[n]){e=!1;break}}}}else e=!1;let t=this.readyStatus;return this.readyStatus=e,e&&this.handleReady(!0===this.readyStatus&&!t),e}handleReady(e=!1){e&&Ie.handlePvFirstReady(),"mini"==i.client.clientType&&i.client.bindClientInfo2Inst(this),i.clientInfo.tcpReady?le({...this.common,ubtList:this.pendingQueue},"tcp",!1):z(this.pendingQueue,x.processChunkCount,(e=>{this.sender.push(this,e)})),this.pendingQueue=[]}isRepeatError(e){if(this.clearErrorTimer){var t=[e.category,e.message,e.file,e.line,e.column].toString();if(this.reportedErrorSet.has(t))return!0;this.reportedErrorSet.add(t)}return!1}sendFPMetric(){let e=this;Ie.get({name:"afp",handleResolve:t=>{t&&e.send({type:o.METRIC,key:"bbz_ubt_fp",data:{tag:t}})}})}setCommon(){this.common={context:{},business:{},user:{}};try{var e,t,n,r;this.common.context={pid:this.pageId,vid:this.bfa.vid,sid:this.bfa.sid,pvid:this.bfa.pvid,version:`${U.version}${i.client.sdkVerSuffix||""}`,appId:this.appId,fromPage:null===(e=this.lastView)||void 0===e?void 0:e.pageId,fromPvid:null===(t=this.lastView)||void 0===t?void 0:t.pvid,fromSid:null===(n=this.lastView)||void 0===n?void 0:n.sid,trafficSource:i.client.getTrafficSource(this),newVisitor:1==this.bfa.sid,newSession:1==this.bfa.pvid};let s=this.common.business.attrs={enterTs:U.enterTs,instKey:this.props.instKey};null!==(r=U.ubtCom)&&void 0!==r&&r.symbol&&(s.npmVersion=U.ubtCom.version,s.npmEnterTs=U.ubtCom.enterTs),i.clientInfo.tcpReady&&(s.web_pvid=`${this.bfa.vid}_${this.bfa.sid}_${this.bfa.pvid}`),"mini"==i.clientType&&(s.mpaasAppId=i.mini.mcdAppId),this.bindBiz2Common(),i.client.bindClientInfo2Inst(this,!0)}catch(e){c.reportError("setCommon error.",e,this.instKey)}}bindBiz2Common(){let{orderId:e,productId:t,loginName:i,url:n,isBack:r,refer:s,abTest:o,...a}=this.business;void 0!==n&&(this.common.context.url=null==n?void 0:n.substring(0,this.sendSetting.urlMaxLength)),void 0!==s&&(this.common.context.referrer=s),void 0!==o&&(this.common.user.abTest=o),Object.assign(this.common.business,{orderId:e,productId:t}),Object.assign(this.common.business.attrs,a),Object.assign(this.common.user,{userId:i||this.common.user.userId})}setBfa(e){let{bfa:t,ls_val:n}=i.client.readBfa();e&&"web"==i.client.clientType&&(this.business.init_cki=re(document.cookie)),this.bfa=new me(t),this.lastView="function"==typeof i.client.readLastView?i.client.readLastView(this,t):t;let r=this.bfa.genVid();r||(r=i.clientInfo.vid),r&&T.VID.test(r)||(r=Ae.genVidVal());let s=r.split(".");if(Object.assign(this.bfa,{vid:r,vid_ts:parseInt(s[0]),id:s[1]}),this.bfa.sid&&this.bfa.pvid){this.beginTs-this.bfa.session_ts>E?(this.bfa.sid++,this.bfa.pvid=1):this.bfa.pvid++,this.bfa.lastSession_ts=this.bfa.session_ts,this.bfa.session_ts=this.beginTs}else this.bfa.lastSession_ts=this.beginTs,this.bfa.session_ts=this.beginTs,this.bfa.sid=1,this.bfa.pvid=1;return this.bfa.pageId=this.pageId,"function"==typeof i.client.updateBfaFromServer&&i.client.updateBfaFromServer(this.bfa),i.client.writeBfa(this,!0,!1),i.client.writeVID(r),this.bfa}},we="unknown",{SK:_e}=t,ye={success:!0};class be{static findUbtInst(e){var t;let{pvId:i,options:n}=e;if(!(a(e.data,e.type)&&null!=n&&n.force&&Array.from(U.instMap.values()).every((e=>!1===e.readyStatus)))){if(i)return U.instMap.get(i);if(null!=n&&n.cacheGroupKey){return Array.from(U.instMap.values()).find((e=>e.cacheGroupKey==(null==n?void 0:n.cacheGroupKey)))}return null!==(t=U.curInst)&&void 0!==t&&t.cacheGroupKey?void 0:U.curInst}if(U.bfrInst)return U.bfrInst;this.bfrTimer||(this.bfrTimer=setTimeout((()=>{var e;be.register({pageId:R,appId:(null==U||null===(e=U.curInst)||void 0===e?void 0:e.appId)||5292,instKey:R},!0),this.bfrTimer=null}),x.pvReadyWaitTime||500))}static ubtApiPush(e,t){try{if(e.options||(e.options={cacheGroupKey:e.cacheGroupKey,context:e.context,triggerTs:e.triggerTs}),"boolean"==typeof e)return ye;if(!e||!e.type||"destroy"!=e.type&&!e.data)throw new d("Invalid push data.");let{type:i,data:n,pvId:r,options:s}=e;if(function(e,t){return"register"==t}(0,i)){let e={...n};return r&&(e.instKey=r),null!=s&&s.triggerTs&&(e.registerTs=null==s?void 0:s.triggerTs),null!=s&&s.context&&(e.context=null==s?void 0:s.context),e.cacheGroupKey=null==s?void 0:s.cacheGroupKey,be.register(e)}if(function(e,t){return"get"==t}(0,i))return be.get(n,r);if(a(0,i)||function(e,t){return"set"==t}(0,i))return be.invokeInstApi(e,t);if("destroy"==i)return be.destroy(r)}catch(e){c.printError("Push error.",e)}}static handlePvFirstReady(){be.bfrTimer&&(clearTimeout(be.bfrTimer),be.bfrTimer=null),_e(be.BF_FORCE_REQS,x.processChunkCount,(e=>{be.ubtApiPush(e,!0)}))}static handleBfRegisterReq(e){if(e==R)return;let t=[];e!=we&&t.push(be.BF_REGISTER_MAP.get(we)),t.push(be.BF_REGISTER_MAP.get(e));for(let e=0;e<t.length;e++){const i=t[e];i&&0!=i.length&&_e(i,x.processChunkCount,(e=>{be.ubtApiPush(e,!0)}))}}static handleBfClientReadyReq(){_e(be.BF_CLIENTREADY_REQS,x.processChunkCount,(e=>{be.ubtApiPush(e)}))}static register(e,t){try{if(e.instKey){if(U.instMap.has(e.instKey))return e.instKey}else e.instKey=oe(6);if(!be.pushCheck({data:e,type:"register"}))return e.instKey;"mini"==i.clientType&&(e.appId=e.appId||i.mini.appId);let n=new ve(e);return t?n:e.instKey}catch(e){c.printError("register err.",e)}}static get(e,t){let{name:n,timeout:r,sync:s,handleResolve:o,handleReject:a,watch:l}=e||{};try{if(!n)return;"function"!=typeof o&&(s=!0);let c,d=e.name+("bfa"==e.name&&t?`_${t}`:"");if("vid"==d&&i.clientInfo.hostVid)return s?i.clientInfo.hostVid:o&&o(i.clientInfo.hostVid);if(s)return i.watcher.getTriggeredVal(d);let u=setTimeout((()=>{"function"==typeof a?a("get timeout."):o&&o(null)}),null!=r?r:5e3);c=function(e){clearTimeout(u),o&&o(e)},l&&(c.prototype.watch=!0),i.watcher.watch(d,c)}catch(e){c.reportError("get error",e,t),a?a(e):o&&o(null)}}static send(e,t,i){return this.invokeInstApi({type:"send",data:e,pvId:t,options:i})}static set(e,t){return this.invokeInstApi({type:"set",data:e,pvId:t})}static destroy(e){U.instMap.has(e)&&(U.instMap.delete(e),U.curInst=U.instMap.values().next().value)}static getDebugUrl(e){return"mini"==i.clientType?i.miniAppClient.getDebugUrl(e):""}static switchMagnet(e=!0){return"mini"==i.clientType?i.miniAppClient.switchMagnet(e):""}static inMagnetDebug(){return"mini"==i.clientType?i.miniAppClient.inMagnetDebug():""}static pushCheck(e){return!!i.client.clientReady||(be.BF_CLIENTREADY_REQS.push(e),!1)}static invokeInstApi(e,t){try{var i;let{triggerTs:r,cacheGroupKey:s,force:o,samle:a,isMultiSend:l,isSendBeacon:c}=e.options||{};if(a){if(Math.floor(100*Math.random())+1>a)return ye}if(r=r||Date.now(),!be.pushCheck(e))return ye;let{type:u,data:p,pvId:h,options:f}=e,g=be.findUbtInst(e);if(o&&!g)return this.BF_FORCE_REQS.push(e),ye;let m=h||we,v=!g||!(null===(i=be.BF_REGISTER_MAP.get(m))||void 0===i||!i.length)&&!t;if(v){var n;if(be.BF_REGISTER_MAP.has(m)&&Array.isArray(be.BF_REGISTER_MAP.get(m)))null===(n=be.BF_REGISTER_MAP.get(m))||void 0===n||n.push(e);else be.BF_REGISTER_MAP.set(m,[e])}else{if("function"!=typeof g[u])throw new d(`inst:${!!g},type:${u},bufferReq:${v}`);g[u](p,null==f?void 0:f.triggerTs,l,c)}return ye}catch(e){return c.printError("invokeInstApi error",e),{success:!1,message:null==(r=e)?void 0:r.message}}var r}}s(be,"BF_CLIENTREADY_REQS",[]),s(be,"BF_REGISTER_MAP",new Map),s(be,"BF_FORCE_REQS",[]);const Ie=be;class Te{constructor(){s(this,"clientReady",!1),s(this,"lsStatus",[new Set,0]),s(this,"distinctErr",!0),this.watcher=new l}handleClientReady(){this.clientReady=!0,Ie.handleBfClientReadyReq()}beforeOpLs(e,t,i){let n=this.lsStatus,r=this.getLs(t);null!=i&&"r"!=e||(i=""),null==r&&(r="");let s="string"==typeof i?i:JSON.stringify(i),o="string"==typeof r?r:JSON.stringify(r);n[1]+=s.length-o.length,"s"==e?n[0].add(t):n[0].delete(t)}setVid(){let e=this.readVid();if(!e){let{bfa:t}=this.readBfa();e=null==t?void 0:t.genVid(),e||(e=Ae.genVidVal()),this.writeVID(e)}return this.watcher.trigger("vid",e),this.clientInfo.vid=e}triggerBfa(e){if(!e||!e.bfa||e.instKey==R)return;let{bfa:t,instKey:i}=e;[`bfa_${i}`,"bfa",`batHeader_${i}`,"batHeader"].forEach((e=>{let i=e.startsWith("bat"),n=i?"x-ctx-ubt-":"";this.watcher.trigger(e,{[`${n}vid`]:t.vid,[`${n}sid`]:t.sid,[`${n}pvid`]:t.pvid,[`${n}${i?"pageid":"pageId"}`]:t.pageId})}))}}let Se=function(e){return e.hybrid="hybrid",e.H5="h5",e.Online="online",e}({}),Ee=function(e){return e[e.NaN=0]="NaN",e[e.Number=1]="Number",e[e.Boolean=2]="Boolean",e[e.String=3]="String",e[e.Array=4]="Array",e[e.Object=5]="Object",e[e.Undefined=6]="Undefined",e[e.Null=7]="Null",e[e.RegExp=8]="RegExp",e[e.Error=9]="Error",e[e.Function=10]="Function",e[e.Unknown=11]="Unknown",e}({});const{QP:Ce,Jg:Re}=t;const Ae={refreshUbtConfigLs:async function(){let e={appId:"5278",categoryList:["ubtconfig"],head:{appid:"5278",cid:i.clientInfo.vid,cver:"000.001",sid:"8892"}},{success:t,data:n}=await i.client.request({body:JSON.stringify(e),url:te(i.clientInfo)});if(t){var r;let e=null===(r=((null==n?void 0:n.configList)||[])[0])||void 0===r?void 0:r.configContent;if(!e)return;i.client.setLs(I,e)}},setUbtConfig:function(e){e&&(Object.assign(x,e),i.clientInfo.tcpReady=i.clientInfo.tcpReady&&x.tcpSwitch)},genVidVal:function(){return`${Date.now()}.${oe(12)}`},isUbtErrorData:function(e,t){return e==o.ERROR},ubtPropsCheck:function(e){if(!e||!e.appId)throw new d("appId is required !");let{appId:t,settings:n}=e;if("web"==i.clientType&&"string"!=typeof t&&"number"!=typeof t)throw new d("appId must be a number !");if(null!=n&&n.waitingFields&&!Array.isArray(n.waitingFields))throw new d("waitingFields must be type of string[] !")},validateSendRequest:function(e){let{type:t,key:i,data:n}=e,r=[...Object.values(o)],s=`${t}-${i}`;if(!r.includes(t))throw new d(`${s}: Unsupported sending type: ${t}! The supported types include ${r.join(", ")}.`);if(i&&(!["number","string"].includes(typeof i)||i.toString().length>100))throw new d(`${s}: illegal key.`);let a=Ce(n);if(t==o.PV||a!=Ee.Null&&a!=Ee.Undefined||(e.data=""),function(e){return e==o.METRIC||e==o.MONITOR}(t)||function(e){return e==o.MONITOR}(t)){if(null!=n&&n.value&&!function(e){let t=Ce(e=e||0);if(t==Ee.Number)return!0;if(t==Ee.Object){let t=Object.keys(e);for(let i=0;i<t.length;i++)(i>=30||Ce(e[t[i]])!=Ee.Number)&&delete e[t[i]];return!0}return!1}(n.value))throw new d(`${s}: illegal Value:${JSON.stringify(n)} from ${i}`);if(null!=n&&n.tag&&!function(e,t){t=t||!1;let i=Object.keys(t);for(let e=0;e<i.length;e++){let n=i[e],r=t[n],s=Ce(r);[Ee.String,Ee.Boolean,Ee.Number].includes(s)||delete t[n]}return!0}(0,n.tag))throw new d(`${s}: illegal tag from ${i}.`)}if(JSON.stringify(n||"").length>51200){let t=e.data=`${s}: data is too long. The maximum data size is 50KB.`;c.printError(t)}return!0},stringifySendData:function(e){let{data:t,type:i}=e;if(i==o.METRIC||i==o.MONITOR)return;if(!t||Ce(t)!=Ee.Object)return;let n={};for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e)){let i=t[e];switch(typeof i){case"undefined":case"symbol":case"function":break;case"object":let t;"extendedField"==e&&(t=(e,t)=>e&&"string"!=typeof t?JSON.stringify(t):t),n[e]=JSON.stringify(i,t);break;default:n[e]=i}}e.data=n},transformUbtData:function(e){let{type:t,key:n,data:r}=e,s={},a=Ce(r);if(a==Ee.Null||a==Ee.Undefined)return null;let l=a==Ee.Object?r:{data:r};switch("mini"==i.clientType?l.applet_scene=i.mini.scene:(l.tld=i.clientInfo.tld,Object.assign(l,i.clientInfo.cargo)),t){case o.TRACE:case o.DEV_TRACE:s={key:n,val:l};break;case o.PRIVATE_TRACE:s={key:n,val:r};break;case o.METRIC:case o.MONITOR:s={name:n,tags:r.tag,value:r.value};break;case o.EXPOSURE:s={key:n,data:r};break;default:s={key:n,...l},t==o.ERROR&&(!s.ownerOrgId&&s.organizationId&&(s.ownerOrgId=s.organizationId),s.category=i.client.errCategory)}return s},transMetricIfBizError:function(e){var t;if(e.type!=o.ERROR)return;let i=e.data||{};"framework"!=(null===(t=i.extendedField)||void 0===t?void 0:t.from)&&(e.key="biz_manual_error",e.type=o.METRIC,e.data={tag:i})}},ke=window.UBT_BIZCONFIG||{};function Oe(){let e=Date.now();N.fpSwitch=1,window.document.addEventListener("cfp_loaded",(()=>{N.fpTime=Date.now()-e;try{let e=window.cfp.toString();$(e)!=Ee.Object&&(e={});let{browserId:t,secStr:n}=e;U.fp=t,U.ffp=n,i.watcher.trigger("fp",t),i.watcher.trigger("ffp",n),i.watcher.trigger("afp",{fp:t,ffp:n})}catch(e){c.reportError("listen c_sec_loaded error.",e)}})),i.webClient.loadScript(function(e,t){let i=ee(e);if(e.isTravix)return`${i}${Z(e)}/train/csec/*/c-sec.js`;return`${i}${Y(e)}/ares2/train/csec/${t}/default/sec/c-sec.js`}(i.clientInfo,x.fpVersion))}const Pe={loadModules:function(){try{let{isLoadFP:e,isLoadMarketing:t,isLoadRMS:n}=ke;!1!==e&&Oe(),!1!==n&&i.webClient.loadScript(function(e){let t=ee(e);if(e.isTravix)return`${t}${Z(e)}/sysdev/rms.ubt/*/travix/${e.isOnline?"rms":"mrms"}.js`;return`${t}${Y(e)}/ares2/risk/ubtrms/*/default/${e.isOnline?"rms":"mrms"}.js`}(i.clientInfo)),setTimeout((()=>{i.clientInfo.isTravix||i.clientInfo.isTrip||!1===t||i.webClient.loadScript(function(e){let t=ee(e);return e.isOnline?`${t}//static.tripcdn.com/packages/market/mkt-union-tracing/*/ResUnionOnline/remarketing/remarketing.js`:`${t}//static.tripcdn.com/packages/market/mkt-union-tracing/*/ResAdvOnline/sales/h5Redirect.js`}(i.clientInfo))}),0)}catch(e){c.reportError("loadModules err.",e)}}};class Be{static initConsole(){window.UBT_DEV={cdata(){var e;let t=null==U||null===(e=U.curInst)||void 0===e?void 0:e.bfa,{vid:n,sid:r,pvid:s}=t||{};if(n&&r&&s){let e=`${Be.CDATA_URL}/${n}/${r}/${s}${i.clientInfo.isProd?"":"?env=fws"}`;window.open(e,"_blank")}return n},magnet(){var e,t;let i=(null==U||null===(e=U.curInst)||void 0===e?void 0:e.bfa)||(null==U||null===(t=U.bfrInst)||void 0===t?void 0:t.bfa),{vid:n}=i||{};if(n){let e=`${Be.MONITOR_URL}?id=${n}&type=vid`;window.open(e,"_blank")}return n},get bfa(){var e;return(null==U||null===(e=U.curInst)||void 0===e?void 0:e.bfa)||{}},get vid(){var e;return null==U||null===(e=U.curInst)||void 0===e||null===(e=e.bfa)||void 0===e?void 0:e.vid}}}static async switchMagnet(){try{let e,{magnetKey:t,magnetOn:n}=i.webClient.getUrlSearchObject()||{};if(t&&"true"===n&&(e=await Be.connectMagnet(t)),"false"===n&&(e=!1,Be.disconnectMagnet(t)),null==e){let n=i.webClient.getCookie(y);!n||t&&t!=n||(e=!0)}U.magnetSwitch=e}catch(e){c.reportError("switchMagnet error.",e)}}static inMagnetDebug(){if(!U.magnetSwitch)return!1;let e=i.webClient.getCookie(y);return U.magnetSwitch=!!e,U.magnetSwitch}static updateMagnetMaxAge(){let e=i.webClient.getCookie(y);e&&i.webClient.setCookie(y,e,C)}static async connectMagnet(e){try{i.webClient.setCookie(y,e,C);let t=`${Be.MAGNET_SVC_URL}/${e}?type=debugOn`,n=await fetch(t,{headers:{"Content-Type":"application/json;charset=UTF-8"},method:"POST",body:JSON.stringify({debug:!0,vid:i.clientInfo.vid,meta:{sdkver:U.version}})});if(200==n.status){return!0===(await n.json()).success}return!1}catch(e){return c.reportError("connectMagnet error.",e),!1}}static async disconnectMagnet(e){i.webClient.removeCookie(y)}}s(Be,"MONITOR_URL","http://magnet.mobile.uat.qa.nt.ctripcorp.com/monitor"),s(Be,"MAGNET_SVC_URL","//magnet.mobile.uat.qa.nt.ctripcorp.com/web/access"),s(Be,"CDATA_URL","https://mpaas.ctripcorp.com/cdataV2/session");const Me=Be,Le=/^(?:https?:\/\/)?((?:www\.)?[^:\/\n?]+)/im,Ne=/(ubt\.bk\.css)|(28fc6e091c074648c325123570ef670e7eba1e26)|(ubt\.exp\.js)|(617dcb2abddae4bcbeed)/;class Ue{static getFFP(){return Ue.ffp?Ue.ffp:Ue.ffp=Ie.get({name:"ffp",sync:!0})}static start(){try{var e,t;if("undefined"==typeof performance||"function"!=typeof performance.getEntriesByType)return;if(this.nameRule=(null===(e=x.perfConfig)||void 0===e?void 0:e.nameRule)||{},0==Object.keys(this.nameRule).length||0==(null===(t=x.perfConfig)||void 0===t?void 0:t.sample))return;let i=performance.getEntries().filter((e=>["resource","navigation"].includes(e.entryType)));this.pushResourceTiming(i||[]),this.observeResource()}catch(e){c.reportError("Perf.start err.",e)}}static observeResource(){if(this.observed||"undefined"==typeof PerformanceObserver)return;new PerformanceObserver((e=>{let t=e.getEntries();t&&this.pushResourceTiming(t)})).observe({entryTypes:["resource","navigation"]}),this.observed=!0}static triggerReport(){this.pushResourceTiming(void 0,!0)}static pushResourceTiming(e,t){if(!e)return Ue._pushResourceTiming(void 0,t);let i=[];if(e)for(let t=0;t<e.length;t+=20)i.push(e.slice(t,t+20));z(i,1,(e=>{Ue._pushResourceTiming(e,t)}))}static _pushResourceTiming(e,t){try{if(null==e||e.forEach((e=>{var t;this.countBlockPingTimes(e);let i=this.checkEntry(e);if(!i)return;if(e.duration<=0||0==e.transferSize)return;let n=e.startTime||e.redirectStart||e.workerStart||e.fetchStart||e.domainLookupStart||0,r={name:e.name,totalTime:e.duration,ttfb:e.responseStart-n,download:e.responseEnd-e.responseStart,dnsTime:e.domainLookupEnd-e.domainLookupStart,tcpTime:e.connectEnd-e.connectStart,redirectTime:e.redirectEnd-e.redirectStart,responseStatus:null!==(t=e.responseStatus)&&void 0!==t?t:"Empty",transferSize:e.transferSize,encodedBodySize:e.encodedBodySize,decodedBodySize:e.decodedBodySize},s=U.instMap.keys().next().value;"www.ctrip.com"==i&&"navigation"==e.entryType?Ie.send({type:o.METRIC,key:"bbz_perf_specres_timing",data:{tag:r}},s):this.UBT_TIMINGS.push(r)})),0==this.UBT_TIMINGS.length)return;i.webClient.clientInfo.isNfesCore||this.reportPerfs(t)}catch(e){c.printError("Perf.pushResourceTiming err.",e)}}static reportPerfs(e){let t=this.lastReportTs?3e3-(Date.now()-this.lastReportTs):0;if(!(e||t<=0))return void(this.nextExecTimer||(this.nextExecTimer=window.setTimeout((()=>{Ue.triggerReport(),Ue.nextExecTimer=void 0}),t)));let i=U.instMap.keys().next().value;for(;this.UBT_TIMINGS.length>0;){var n;let e=this.UBT_TIMINGS.splice(0,10);Ie.send({type:o.METRIC,key:"bbz_perf_resource_timing",data:{tag:{timings:JSON.stringify(e)}}},i,{samle:null===(n=x.perfConfig)||void 0===n?void 0:n.sample})}this.lastReportTs=Date.now(),this.UBT_TIMINGS=[]}static countBlockPingTimes(e){"beacon"==e.initiatorType&&e.name.indexOf("bee/collect")>0&&0==e.responseStatus&&(console.log("entry: ",e),U.blockPingTimes++)}static checkEntry(e){if(!e||!e.name)return!1;let t=(e.name.match(Le)||[])[1];if(!t)return!1;if(Ne.test(e.name))return t;if(e.name.indexOf("bee/collect")>0)return!1;let i=(null==t?void 0:t.split("."))||[],n=i.splice(-2).join(".")||"",r=i.join(".")||"";if("navigation"!=e.entryType){if(!(n in this.nameRule))return!1;if(-1==this.nameRule[n].indexOf(r))return!1}return t}}s(Ue,"UBT_TIMINGS",[]),s(Ue,"nameRule",{});const xe=Ue;function De(){let e=U.curPv;if(!e)return;let t=Date.now(),{tag:i,...n}=N||{},r={type:o.METRIC,data:{value:{ttl:t-e.startTs,tp:(e.lastLeaveTs||t)-e.startTs-(e.leaveTime||0),...n},tag:i},key:"bbz_ubt_pv_summary"};Ie.send(r,e.id)}const $e={start_point:null,start_touch:!1,moving:!1};function Ve(e){if(!et("unhandledrejection",Ve))try{if(!e||!e.reason)return;let t=e.reason,i="string"==typeof t?null:function(e){var t;if(!e)return;let i=e.split("\n"),n=i[i.length-1];n=null===(t=n)||void 0===t?void 0:t.substring(n.indexOf("(")+1,n.indexOf(")"));let r=n.split(":");return r.length<3?void 0:{column:r.pop(),line:r.pop(),file:r.join(":")}}(null==t?void 0:t.stack),n={name:t.message||t,message:t.message||t,stack:null==t?void 0:t.stack,line:null==i?void 0:i.line,column:null==i?void 0:i.column,file:null==i?void 0:i.file};c.sendErrorUbt(n,"rejection")}catch(e){c.printError("handleRejection error.",e)}}function Ke(e,t,i,n,r){try{var s;if(et("error",Ke))return;let o={name:(null==r?void 0:r.name)||(null==e?void 0:e.message)||e,stack:(null==r?void 0:r.stack)||(null==e||null===(s=e.error)||void 0===s?void 0:s.stack),message:(null==r?void 0:r.message)||(null==e?void 0:e.message),line:i||(null==e?void 0:e.lineno),column:n||(null==e?void 0:e.colno),file:t||(null==e?void 0:e.file)};c.sendErrorUbt(o,"error")}catch(r){c.printError("handleError error.",r)}}function je(e){const{data:t}=e;t&&"send"==t.type&&window.UBT_API.push({type:"send",data:t.data})}function Fe(e,t){let i=0;if("DIV"==t&&(e.attributes["page-url"]||e.getAttribute("page-url")))return"";if(e.parentNode){let t=e.parentNode.firstChild;for(;t&&t!=e;)1==t.nodeType&&t.tagName==e.tagName&&i++,t=t.nextSibling}return i>0?"["+ ++i+"]":""}function qe(e){try{if(!e||!e.target)return;let n=e.target,r=window.document.documentElement,s=window.document.body;if(n&&1==n.nodeType&&n.nodeName&&n.getBoundingClientRect){var t,i;let a,l,c=n.nodeName.toUpperCase(),d=n.getBoundingClientRect(),u="",p=Math.max(r.scrollLeft,s.scrollLeft),h=Math.max(r.scrollTop,s.scrollTop),f=(null===(t=$e.start_point)||void 0===t?void 0:t.pageX)||e.pageX||0,g=(null===(i=$e.start_point)||void 0===i?void 0:i.pageY)||e.pageY||0,m=D((r.clientWidth||s.clientWidth)/2,10);if("SELECT"==c&&g-d.top-h<0?(u+="[@x='"+D(f+d.left+p-m,10)+"'][@y='"+D(g+d.top,10)+"']",a=f,l=g-h):(u+="[@x='"+(f-m)+"'][@y='"+g+"']",a=D(f-d.left-p,10)||0,l=D(g-d.top-h,10)||0),a>=0&&l>=0&&a<=screen.width+p){u+="[@rx='"+a+"']",u+="[@ry='"+l+"']";let e=function(e){let t,i=[],n=0;for(;e&&9!=e.nodeType;){if(1==e.nodeType){let r=(e.nodeName||"").toUpperCase(),s=e.id||"",o=r+Fe(e,r);s&&"function"==typeof s.indexOf&&-1==s.indexOf("client_id_viewport")&&(o+="[@id='"+s+"']"),t=e.getAttribute("data-ubt-key"),t&&(o+="[@cid='"+t+"']"),i[n++]=o}e=e.parentNode}return i.length>2?i.reverse().join("/"):""}(n);e&&Ie.send({type:o.ACTION,key:"action",data:{xpath:e+u,action:"auto"}})}}}catch(e){c.printError("handleClick error.",e)}}function ze(e){$e.start_point=e.touches&&e.touches[0]||e,$e.moving=!1,$e.start_touch=!0}function Ge(e){if($e.start_touch){var t,i;let n=e.touches&&e.touches[0]||e,r=0,s=0;r=Math.abs(n.pageX-((null===(t=$e.start_point)||void 0===t?void 0:t.pageX)||0)),s=Math.abs(n.pageY-((null===(i=$e.start_point)||void 0===i?void 0:i.pageY)||0)),$e.moving=!(r<6||s<6)}}function Je(e){et(Ze,Je)||(!$e.moving&&$e.start_touch&&qe(e),$e.start_touch=!1,$e.start_point=null)}function We(){var e;x.switchBackWvPv&&U.curInst&&(ke.isDisableBackWvPv||!ke.isOpenBackWvPv&&(x.backWvPvBlackList||[]).includes(U.curInst.appId+"")||null===(e=U.curInst)||void 0===e||e.refreshPv())}const Xe=function(){let e;return function(){e||(e=!0,i.webClient.clientInfo.isNfesCore||xe.triggerReport(),window.UBT_COMP||De())}}();let Qe="ontouchstart"in window,He=Qe?"touchstart":"mousedown",Ye=Qe?"touchmove":"mousemove",Ze=Qe?"touchend":"mouseup";function et(e,t){return!!window.__CORE_INIT__&&(window.removeEventListener(e,t),!0)}const tt={init:function(){var e;(!i.webClient.clientInfo.isNfesCore||null!==(e=window.__CORE_SDK__)&&void 0!==e&&e.checkNew)&&(window.addEventListener("error",Ke),window.addEventListener("unhandledrejection",Ve),i.webClient.clientInfo.isTravix||(window.document.addEventListener(He,ze,!0),window.document.addEventListener(Ye,Ge,!0),window.document.addEventListener(Ze,Je,!0))),window.addEventListener("message",je),window.addEventListener("beforeunload",(()=>{Xe()})),window.addEventListener("pagehide",(()=>{Xe()})),window.document.addEventListener("visibilitychange",(e=>{!async function(){let e=U.curPv;if(!e)return;let t=Date.now(),i=document.visibilityState;"hidden"==i?e.lastLeaveTs=t:"visible"==i&&(e.leaveTime=(e.leaveTime||0)+(e.lastLeaveTs?t-e.lastLeaveTs:0),e.lastLeaveTs=0)}(),"visible"===window.document.visibilityState&&U.curInst&&i.webClient.writeLastView(U.curInst)})),"undefined"!=typeof CtripEventListener&&"function"==typeof CtripEventListener.addHybridEventListener&&CtripEventListener.addHybridEventListener("onPageDidAppear",We)}},it="UBT_INDEXDB",nt="UBT_TABLE";function rt(e,t){return new Promise(((i,n)=>{let r,s;try{s=window.indexedDB.open(e)}catch{i(r)}s.onupgradeneeded=async e=>{if(r=e.target.result,r.objectStoreNames.contains(t))i(r);else try{r.createObjectStore(t,{keyPath:"key"}).transaction.oncomplete=function(){i(r)}}catch(e){console.log("openIndexDB error",e),i(void 0)}},s.onsuccess=n=>{if(r=n.target.result,r.objectStoreNames.contains(t))i(r);else{const n=r.version+1;r.close();window.indexedDB.open(e,n).onupgradeneeded=function(e){const n=e.target.result;try{n.createObjectStore(t,{keyPath:"key"}).transaction.oncomplete=function(){i(n)}}catch(e){console.log("openIndexDB error",e),i(void 0)}}}},s.onerror=e=>{i(r)}}))}function st(e){return async function(e,t,i){return new Promise((async(n,r)=>{let s;"string"==typeof t&&"string"==typeof i||n(s);let o=await rt(t,i);if(o)try{let t=o.transaction(i).objectStore(i).get(e);t.onsuccess=function(){var e;s=null==t||null===(e=t.result)||void 0===e?void 0:e.val,n(s)},t.onerror=function(){n(s)}}catch(e){console.log("get data fail",e),n(!1)}else console.log("get db fail."),n(s)}))}(e,it,nt)}function ot(e,t){return async function(e,t,i,n){return new Promise((async(r,s)=>{"string"==typeof i&&"string"==typeof n||r(!1);let o=await rt(i,n);if(o)try{let i=o.transaction(n,"readwrite").objectStore(n).put({key:e,val:t});i.onsuccess=function(){r(!0)},i.onerror=function(){r(!1)}}catch(e){console.log("set data fail",e),r(!1)}else r(!1)}))}(e,t,it,nt)}const at=window.UBT_COMP||{},lt={_trace:o.TRACE,_tracklog:o.TRACE,_devTrace:o.DEV_TRACE,_privateTrace:o.PRIVATE_TRACE,_exposure:o.EXPOSURE,_trackMetric:o.METRIC,_trackMatrix:o.METRIC,_trackError:o.ERROR,_trackUserBlock:o.USER_BLOCK};function ct(e){U.curPv&&U.curPv.pageId!==R&&De(),U.curPv={startTs:Date.now(),id:e.instKey,pageId:e.pageId},1==U.instMap.size&&setTimeout((()=>{!function(){window.__bfi=window.__bfi||[];const e=window.__bfi;N.init_old_counts=e.length,z(e,x.processChunkCount,ut,(()=>{window.__bfi.push=ut})),window.$_bf=window.$_bf||{},window.$_bf._getStatus=function(){let e=U.curInst;if(!e)return{};let{context:t,user:i}=(null==e?void 0:e.getCommon())||{};return{vid:null==t?void 0:t.vid,sid:null==t?void 0:t.sid,pvid:null==t?void 0:t.pvid,abtest:null==i?void 0:i.abTest,pid:e.pageId,pv:e.pvSend}}}()}),0)}async function dt(){try{if(window.UBT_API=window.UBT_API||[],$(window.UBT_API)!=Ee.Array)return;window.UBT_API_TEMP={push:Ie.ubtApiPush};let e=await async function(){if(0!==Object.keys(at).length)return j(at.version,"1.4.7")<=0||j(at.version,"1.5.1")>=0?i.webClient.getLs(_,!0)||[]:await st(_)}()||[];$(e)==Ee.Array&&window.UBT_API.unshift(...e);let t=window.UBT_API;N.init_new_counts=t.length,z(t,x.processChunkCount,Ie.ubtApiPush,(()=>{delete window.UBT_API_TEMP,window.UBT_API.push=Ie.ubtApiPush,window.UBT_API.rewrited=!0}),(()=>{try{if(0==e.length)return;e.splice(0,x.processChunkCount),function(e){0!==Object.keys(at).length&&(j(at.version,"1.4.7")<=0||j(at.version,"1.5.1")>=0?i.webClient.setLs(_,JSON.stringify(e)):ot(_,e))}(e)}catch(e){c.printError("afterUnitTaskCb error.",e)}}))}catch(e){c.reportError("ProcessUbtApi error.",e)}}function ut(e){try{let[t,...i]=e;if(["_getFullPV","_getStatus","_getFP","_getPageid"].includes(t)){let e,n=i[0],r="function"==typeof n;switch(t){case"_getFullPV":return Ie.get({name:"bfa",handleResolve:function(e){r&&n(e?`${e.vid}.${e.sid}.${e.pvid}`:"")}});case"_getStatus":return Ie.get({name:"bfa",handleResolve:function(e){r&&n(e?{vid:e.vid,sid:e.sid,pvid:e.pvid,pid:e.pageId}:{})}});case"_getPageid":return Ie.get({name:"bfa",handleResolve:function(e){r&&n(!1,null==e?void 0:e.pageId)}});case"_getFP":let e=i[1];return Ie.get({name:"fp",handleResolve:function(t){if(!r)return;let i="";t&&(i=`a${encodeURIComponent(t)}`),e?n(JSON.stringify({fp:t,sfp:i})):n(t,i,t)}})}return void(n&&"function"==typeof n&&n(e))}let n=U.curInst;if(!n)return;let r=lt[t];if(!r)return;let s,a="",l=null;switch(r){case o.TRACE:case o.DEV_TRACE:case o.PRIVATE_TRACE:case o.EXPOSURE:a=i.shift(),s=i[0],l=i[1];break;case o.METRIC:if("_trackMetric"==t){let e=i[0]||{};a=e.name,s={tag:e.tag,value:e.value}}else"_trackMatrix"==t&&(a=i[0],s={tag:i[1],value:i[2]},l=i[4]);break;case o.ERROR:case o.USER_BLOCK:s=i[0],l=i[1];break;default:throw new d("unsupported old push: "+JSON.stringify(e))}n.send({type:r,key:a,data:s}),"function"==typeof l&&l()}catch(e){c.reportError("Old api push error.",e)}}let pt=!1;function ht(){pt?N.leaveTag=1:(pt=!0,at&&at.symbol&&j(at.version,"1.1.1")<=0&&(c.printWarn(`@ctrip/ubt-web: ${at.version}: >1.3.x`),function(){window.UBT_CTOR=ve;let e=i.webClient.getLs(w,!0)||[],{insts:t}=at,n=[...e,...t||[]];n&&0!=n.length&&(n.forEach((e=>{let{props:t,registerTs:i,requestQ:n,instKey:r}=e,s=new ve({...t,registerTs:i,instKey:r});ct(s),e.realInst=s,n.forEach((e=>{let{name:t,data:i,triggerTs:n}=e;s[t](i,n),e.hasReceived=!0}))})),i.webClient.removeLs(w),at.insts=[])}()),dt())}U.consumer=ht;const ft={init:ht,handleAfterRegister:ct};let gt=window.navigator.userAgent.toLowerCase();const mt="WECHATMINIAPP",vt="OLDQUICKAPP",wt="NEWQUICKAPP",_t="ALIPAYAPP",yt="BAIDUAPP",bt="TOUTIAOAPP",It="QQAPP",Tt="KUAISHOUAPP";function St(){return/micromessenger/i.test(gt)&&(gt.includes("miniprogram")||"miniprogram"===window.__wxjs_environment)}function Et(){return gt.includes("mode-quickapp")}function Ct(){let e=!1;try{return St()?e=mt:/(hap|OPPO\/Hybrid)\/\d/i.test(gt)&&!Et()?e=vt:Et()?e=wt:!function(){let e=gt.includes("alipayclient")&&(gt.includes("miniprogram")||gt.includes("alipayide")),t=gt.match(/aliapp\((uc|quark)\/[0-9]+\.[0-9]+\.[0-9]+\)/i),i=gt.includes("aliapp")&&gt.includes("amapclient");return e||t||i}()?/swan\//.test(gt)||/^webswan-/.test(window.name)?e=yt:gt.includes("toutiaomicroapp")?e=bt:gt.includes("qq")&&gt.includes("miniprogram")?e=It:gt.includes("kwapp")&&(e=Tt):e=_t,e}catch(e){return!1}}const Rt="ab_testing_tracker";const At=class extends Te{get errCategory(){var e;return null!==(e=this.clientInfo)&&void 0!==e&&e.isNfesCore?["nfes","nfes-web-core"].includes(this.clientInfo.framework||"")?"NfesCore-Error":"WebCore-Error":"nfes"==this.clientInfo.framework?"Nfes-error":"Web-error"}constructor(){super(),s(this,"clientType","web"),this.init()}async init(){try{window.UBT_GLOBAL=U,U.ubtCom=window.UBT_COMP;let e=Date.now();await this.setClientInfo();this.setCustomParam(),window.UBT_API=window.UBT_API||[],Me.switchMagnet(),this.initUbtConfig();let t=Date.now();Pe.loadModules(),tt.init(),ft.init(),xe.start(),Me.initConsole(),this.cleanInvalidLsKeys();let i=Date.now();N.microTime=i-t,this.handleClientReady();let n=Date.now();N.macroTime=n-e}catch(e){c.printError("init err",e)}}handleAfterRegister(e){ft.handleAfterRegister(e)}refreshClientEnv(){}initUbtConfig(){try{var e;let i;var t;if(this.clientInfo.isTravix||null!==(e=window)&&void 0!==e&&e.bizCustomCollectUrl)i=x;else i=null===(t=window.UBT_COMP)||void 0===t?void 0:t.ubtConfig,i?U.summary.prefetchConfig=1:(i=this.getLs("UBT_CONFIG",!0),Ae.refreshUbtConfigLs());i&&Ae.setUbtConfig(i)}catch(e){c.reportError("initUbtConfig error.",e)}}getTrafficSource(e){return e.business.trafficSource||this.clientInfo.miniType||""}getFramework(){try{var e,t;if(window.__NFES_DATA__||window.__NEXT_DATA__||window.__next_s)return"nfes";if(window.cw_webpackParams)return"crnweb";if(window.__remixContext)return"remix";if(document.querySelector(".imvc-view-item"))return"imvc";if(window.React)return"react";if(window.Lizard||window.LizardLite)return"lizard";if(window.__VUE__||document.querySelector("div")&&null!==(e=document.querySelector("div"))&&void 0!==e&&e.__vue__||document.querySelector("div")&&null!==(t=document.querySelector("div"))&&void 0!==t&&t.__vue_app__)return"vue";if(void 0!==window.__HE_UBT_INIT__)return"he"}catch(e){c.reportError("getFramework err.",e)}return"others"}async setClientInfo(){let e=this,t=this.checkLsSupport(),i=this.getRootDomain();const{location:n,navigator:r}=window,s=null==r?void 0:r.userAgent,o=r&&r.javaEnabled()?1:0,a=T.CTRIP_APP.test(s),l=T.TRIP_APP.test(s),c=!T.MOBILE.test(s),d=null!=ke.isLAN?!!ke.isLAN:T.INTRANET.test(n.href),u=n.protocol,p="https:"!=u&&"http:"!=u,h=null!=ke.isOverseas?ke.isOverseas:T.TRIP.test(n.host),f=!!ke.isTravix,g=null!=ke.isProd?ke.isProd:!T.TEST_ENV.test(n.host),m=/\.uat\./.test(n.host),v=!!window.__ubt_ipv6,w="undefined"!=typeof CtripBusiness&&"function"==typeof CtripBusiness.app_track_UBT_JS_log_V2,_="undefined"!=typeof WebAssembly;let y={clientType:this.clientType,javaEnable:o,isTravix:f,isOnline:c,isCtripApp:a,isTripApp:l,isFile:p,webType:c?Se.Online:w?Se.hybrid:Se.H5,isSupportLS:t,rootDomain:i,tld:null==i?void 0:i.replace(/^\./,""),isTrip:h,isProd:g,isUat:m,isLAN:d,isIPV6:v,protocol:u,tcpReady:w,isSupportWasm:_,get isNfesCore(){return!!window.__CORE_SDK__},get framework(){var t;return this.isNfesCore?null===(t=window.__CORE_SDK__)||void 0===t?void 0:t.framework:e.getFramework()},get captainAppId(){return(window.__CORE_SDK__||{}).AppID||""},get cargo(){return e.getCargoData(this.webType)},miniType:this.getMiniEnv(),simplifyLastView:this.isSimplifyLastView(),hostVid:window.__app_ubt_vid};return y.isSupportSendBeacon=this.checkIsSupportSendBeacon(y),this.shouldChecking=!f,this.clientInfo=y,this.initLsStatus(),this.sdkVerSuffix="/new/"+(h?"t":"c"),this.syncCwxParams(),this.setVid(),await this.setClientIds(),this.clientInfo}isSimplifyLastView(){return T.PAYSITE_HOST.test(this.getUrl())||T.PAYSITE_HOST.test(document.referrer)}bindClientInfo2Inst(e,t){let{common:i,sendSetting:n}=e;try{var r,s,o,a,l,d,u,p,h,f,g,m;let c=this.getLocals(n,t)||{},v={storageLength:this.clientInfo.isSupportLS?null===(r=localStorage)||void 0===r?void 0:r.length:0,env:this.clientInfo.webType,clientId:this.clientID,lang:(null!==(s=null===(o=navigator)||void 0===o?void 0:o.language)&&void 0!==s?s:"").toLowerCase(),screenWidth:screen.width,screenHeight:screen.height,url:null===(a=(null===(l=e.props.context)||void 0===l?void 0:l.url)||this.getUrl())||void 0===a?void 0:a.substring(0,n.urlMaxLength),referrer:null===(d=(null===(u=e.props.context)||void 0===u?void 0:u.referrer)||this.getReferrer())||void 0===d?void 0:d.substring(0,n.urlMaxLength),devicePixelRatio:window.devicePixelRatio||1,cookieLength:document.cookie.length,cookieCount:(document.cookie.match(/[^=]+=[^;]*;?/g)||[]).length,rid:(null===(p=window.__NEXT_DATA__)||void 0===p?void 0:p.rootMessageId)||(null===(h=window.__CORE_SERVER__)||void 0===h?void 0:h.rootMessageId),ua:this.clientInfo.tcpReady?null===(f=navigator)||void 0===f?void 0:f.userAgent:void 0};Object.assign(i.context,c.context,v),Object.assign(i.business,c.business),Object.assign(i.user,{...c.user,userId:i.user.userId||(null===(g=c.user)||void 0===g?void 0:g.userId)});let w=this.getBizTokens(n.bizTokenKeys);w.length>0&&!i.user.duid&&(i.user.duid=w[0]),Object.assign(i.business.attrs,{bizTokens:w,eid:c.eid,framework:this.clientInfo.framework,tcpSend:this.clientInfo.tcpReady,isSupportWasm:this.clientInfo.isSupportWasm,miniAppId:null===(m=this.clientInfo.cwxParam)||void 0===m?void 0:m.appid,isOverseas:this.clientInfo.isTrip?"true":"false",tld:this.clientInfo.tld,captainAppId:this.clientInfo.captainAppId,lsSize:this.lsStatus[1]},c.ubtc,this.clientInfo.cargo),this.setCommon(i.business.attrs)}catch(e){c.reportError("bindClientInfo error.",e)}}readLastView(e,t){var i;let n=document.referrer;if(this.clientInfo.simplifyLastView)return{pageId:null==t?void 0:t.pageId,sid:null==t?void 0:t.sid,pvid:null==t?void 0:t.pvid};let r=this.getLs(p,!0);if(!r)return;let s=Array.from(U.instMap.keys()),o=s.indexOf(e.instKey),a=o>=0?o-1:s.length-1,l=a>=0&&s[a]==r.instKey,c=`${r.host}${r.path}`;if(!l&&n.indexOf(c)<0){let t=r.fromPage;t&&n.indexOf(`${null==t?void 0:t.host}${null==t?void 0:t.path}`)>=0&&r.pageId==e.pageId&&(r=r.fromPage)}var d;(null===(i=r)||void 0===i?void 0:i.pageId)==R&&(r=null!==(d=r.fromPage)&&void 0!==d&&d.pvid?r.fromPage:r);return r}writeLastView(e){try{let t=e.lastView,i={...e.bfa,host:location.host,path:location.pathname,instKey:e.instKey};if(t){let{fromPage:e,...n}=t;i.fromPage=n}this.setLs(p,JSON.stringify(i))}catch(t){c.reportError("writeLastView error.",t,e.instKey)}}readVid(){return this.getCookie(v)}writeVID(e){this.setCookie(v,e||"")}setCustomParam(){let e="magnetcustomparam",t=this.getUrlSearchObject(e);t&&this.setCookie(e,t,36e5,!1)}readBfa(){let e,t=this.getCookie(m),i=me.parse(t),n=this.getLs(h),r=me.parse(n,"ls");return e=r.id&&i.id?r.session_ts>i.session_ts?r:i:i.id?i:r,{bfa:e,cki_val:t,ls_val:n}}updateBfaFromServer(e){let t=this.getCookie("UBT_SERVER_SID"),i=this.getCookie("UBT_SERVER_PVID");t&&(Number.isNaN(t)||(e.sid=parseInt(t)),this.removeCookie("UBT_SERVER_SID")),i&&(Number.isNaN(i)||(e.pvid=parseInt(i)),this.removeCookie("UBT_SERVER_PVID"))}writeBfa(e,t,i){try{let n=e.bfa;if(!n)return;let{bfa:r}=this.readBfa();if(r){if(!(r.id==n.id&&r.sid==n.sid&&r.pvid==n.pvid)&&!t)return;if(r.sid>n.sid||r.sid==n.sid&&r.pvid>n.pvid)return}this.setCookie(m,n.genBfaVal());this.setLs(h,JSON.stringify(n)),i||(this.writeLastView(e),this.triggerBfa(e))}catch(e){c.reportError("writeBfa err.",e)}}reportMagenet(e){this.clientInfo.isProd&&Me.inMagnetDebug()&&(e(),Me.updateMagnetMaxAge())}reportByTcp(e,t){return CtripBusiness.app_track_UBT_JS_log_V2("ubt_js_sdk_v2",e),{success:!0}}reportBySendBeacon(e,t,i,n){let r="";null!=i&&i.headers&&(r="?"+Object.entries(null==i?void 0:i.headers).map((([e,t])=>`${e}=${encodeURIComponent(t)}`)).join("&"));const s={type:"application/json",...null==i?void 0:i.headers};let o=new Blob([e],s);return{success:navigator.sendBeacon(t+r,o)}}syncCwxParams(){try{if(this.clientInfo.isOnline)return;let e=this.getUrlSearchObject("_cwxobj");if(!e)return;let t=V(decodeURIComponent(e));if(null==t||!t.cid)return;t.cid&&t.cid.length>20&&(t.cid=t.cid.slice(0,20)),this.setLs("UBT_FROM_CWX",JSON.stringify({appid:t.appid,cid:t.cid,personalRecommendSwitch:t.personalRecommendSwitch,localRecommendSwitch:t.localRecommendSwitch,marketSwitch:t.marketSwitch})),window.__nfesGlobalDatas||(this.setLs("GUID",t.cid||""),this.setCookie("GUID",t.cid))}catch(e){c.reportError("read CwxParams error.",e)}finally{try{let e=this.getLs("UBT_FROM_CWX",!0);this.clientInfo.cwxParam=e}catch(e){c.reportError("bind CwxParams error.",e)}}}async logErrorBeeCollect(e){try{this.request({url:"https://ubtpv.trip.com/mcd_crash_server/spring/ubt/logError",body:JSON.stringify({method:"/bee/collect",errorMessage:e.message}),headers:{}})}catch(e){}}async request(e,t,i,n,r=0){try{let s;"undefined"!=typeof AbortController&&(s=new AbortController,t&&setTimeout((()=>{var e;return null===(e=s)||void 0===e?void 0:e.abort()}),t));let o={headers:{"Content-Type":"application/json",Accept:"application/json",...e.headers},credentials:i,method:e.method||"POST",body:e.body,signal:s?s.signal:null},a="";if(null!=n&&n.headers){let e={...null==n?void 0:n.headers};r>0&&(e.retry="1"),a="?"+Object.entries(e).map((([e,t])=>`${e}=${encodeURIComponent(t)}`)).join("&")}let l=await fetch(e.url+a,o),c=await l.json();if(200!=l.status)throw new Error("fetch error");let d=200==l.status&&l.ok;return{success:d,[d?"data":"message"]:c}}catch(s){if(n&&r<3){let s=this;setTimeout((()=>{s.request(e,t,i,n,++r)}),1e3)}return{success:!1,message:`${null==s?void 0:s.stack}`}}}async imgRequest(e,t,i,n){let r="";null!=i&&i.headers&&(r=Object.entries(null==i?void 0:i.headers).map((([e,t])=>`${e}=${encodeURIComponent(t)}`)).join("&"));let s=`${e.body}&${r}`;null!=i&&i.backup&&(i.queryLen=s.length);return new Promise(((t,i)=>{let n=!0;try{let i=new Image;i.referrerPolicy="no-referrer",i.width=i.height=1,i.onload=function(e){t({success:!0})},i.onerror=function(e,n,r,s,o){i.onload=i.onerror=null,t({success:!1,message:`imageReport failed.event: ${e}, error: ${o}`}),c.printError((null==o?void 0:o.message)||"imageReport failed.",o)},i.src=`${e.url}?${s}`}catch(e){n=!1,i(e)}}))}async setClientIds(){return new Promise((async e=>{let t=setTimeout((()=>{e(!1)}),100);try{let n="";if(this.clientInfo.isTravix){N.cid_from=1;let e=this.getCookie(b);if(!e){let t=ie(this.clientInfo);if(t){let i=await this.request({url:t,body:"{}"});i.success&&i.data&&(e=i.data.ClientID)}}e&&(this.setCookie(b,e),n=e)}else{var i;if(n=null===(i=this.clientInfo.cwxParam)||void 0===i?void 0:i.cid,N.cid_from=3,!n){N.cid_from=2;let e=this.getCookie("GUID"),t=this.getLs("GUID");n=e||t}}n||delete N.cid_from,N.cid_type=n?/{|"|:/g.test(n||"")?2:1:0,this.clientID=n,clearTimeout(t),this.watcher.trigger("cid",n),e(!0)}catch(e){c.reportError("setClientIds error.",e)}}))}async createCid(e,t=0){try{let i,n={head:{appid:"700062"},appId:"700062",platformCode:1,deviceId:e},r=await this.request({body:JSON.stringify(n),url:ie(this.clientInfo)});return r.success&&r.data&&(i=r.data.clientId),!i&&t<3?this.createCid(e,t++):(t>0&&(N.retryCreateCidTimes=t),i)}catch(i){return this.createCid(e,t++)}}getLocals(e,t){if(this.locals&&!t)return this.locals;try{var i,n,r,s,o;let t=(this.clientInfo.isProd?"PRO":this.clientInfo.isUat?"UAT":"FAT")+"_Servers_Eid",a=this.multiGetCookie([["Session",F.MAP],["CtripUserInfo",F.MAP],["Union",F.MAP],["login_uid"],["weduid"],["corpid"],["bid"],["DUID"],["BDUID"],["Servers_Eid"],[t]]),l=this.batchGetLs([["SOURCEID"],["USER",F.JSONPARSE],["CINFO",F.JSONPARSE]]),c=a.Session||{},d=a.CtripUserInfo||{},u=a.Union||{},p=a.login_uid,h=a.DUID||window.ubt_duid||d.U||"",f=p;if(!h&&!f){let e=l.USER;if(e&&e.value){let t=e.value;f=t.LoginName||t.UserName,h=t.UserID}}let g=u;g||(g=this.getLs("UNION",!0));let m=V(g.exmktID)||{},v=this.getUrlSearchObject(),w=this.getOther(),_=this.getAppInfo(l.CINFO),y=this.getIdc(),b={eid:a[t]||a.Servers_Eid,ubtc:this.readUbtc(),context:{engine:null!==(i=c.SmartLinkCode)&&void 0!==i?i:"",other:JSON.stringify(w),appInfo:_,idc:y},user:{corpid:a.corpid,duid:"we.ctrip.com"==location.hostname?a.weduid:h,userId:f,abTest:this.getABtest(e.abTestMaxLength)},business:{allianceId:null!==(n=g.AllianceID)&&void 0!==n?n:"",allianceSid:null!==(r=g.SID)&&void 0!==r?r:"",allianceOuid:null!==(s=g.OUID)&&void 0!==s?s:"",allianceCreatetime:null!==(o=g.createtime)&&void 0!==o?o:"",sourceId:l.SOURCEID,innerSid:m.innersid||v.innersid,innerOuid:m.innerouid||v.innerouid,pushCode:m.pushcode||v.pushcode}};return this.watcher.trigger("mkt",b.business),this.locals=b}catch(e){c.reportError("getLocals error.",e)}}readUbtc(){let e={},t=this.getCookieAll();for(const i in t)T.UBTC.test(i)&&(e[i.substring(5)]=t[i]);return e}getBizTokens(e){if(!e||0==e.length)return[];e.length>3&&(e=e.slice(0,3));let t=this.multiGetCookie(e.map((e=>[e])))||{};return Object.values(t).filter((e=>!["",null,void 0].includes(e)))}getAppInfo(e){let t={version:(null==e?void 0:e.internalVersion)||"",ver:null==e?void 0:e.version,net:(null==e?void 0:e.networkStatus)||"None",platform:(null==e?void 0:e.platform)||""};return JSON.stringify(t)}getIdc(){let e="";try{let t=document.documentElement;e=t.dataset&&t.dataset.idc||t.getAttribute("data-idc")||""}catch(e){c.reportError("getIdc error.",e)}return(e+"").substring(0,30)}getOther(){let e="";if("object"==typeof window.Lizard){let t=window.Lizard;e=t.selfCollection||t.version||""}let t={fef_name:"",fef_ver:"",rg:this.getCookie("_RSG",""),lang:document.documentElement.getAttribute("lang")||""};return this.clientInfo.isOnline?t.lizard=e:(t.tz=-(new Date).getTimezoneOffset(),t.dt=outerHeight-innerHeight>160||outerWidth-innerWidth>160),t}getABtest(e){try{let t="",i="",n=document.getElementById(Rt),r=[];for(;n;){let e=n.value;/;$/.test(e)||(e+=";"),i+=e,r.push(n),n.removeAttribute("id"),n.removeAttribute("name"),n=document.getElementById(Rt)}for(let e=0;e<r.length;e++)r[e].setAttribute("id",Rt);let s=location.hash;if(s.indexOf("abtest=")>=0){let e=s.replace(/.*(abtest=)/i,"").replace(/#.*/i,"");i+=decodeURIComponent(e)}return e&&e>0?i.substring(0,e):t}catch(e){return c.reportError("getABtest error.",e),""}}getReferrer(){let e="";e=document&&document.referrer;try{!e&&opener&&(e=opener.location&&opener.location.href)}catch(e){}return e}getUrl(){return location.href}setCookie(e,t,i=S,n=!0){let r=this.clientInfo.rootDomain?`;domain=${this.clientInfo.rootDomain}`:"",s="";if(i>=0){s=`;expires=${new Date(Date.now()+i).toUTCString()}`}return n&&(t=encodeURIComponent(t)),document.cookie=`${e}=${t}${r};path=/${s}`}getCookie(e,t,i){let n=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),r=document.cookie.match(n),s=t||"";return r&&(s=i?decodeURIComponent(r[2]):r[2]),s}checkLsPush(){if(!this.clientInfo.isSupportLS)return!1;let[,e]=this.lsStatus;return e<4194304}initLsStatus(e="B"){if(!this.clientInfo.isSupportLS)return this.lsStatus=[new Set,0];let t=0,i=new Set;for(const e in localStorage)if(Object.prototype.hasOwnProperty.call(localStorage,e)){let n=localStorage.getItem(e);null!==n&&(i.add(e),t+=n?n.length:0)}return"KB"==e&&(t=Math.ceil(t/1024)),"MB"==e&&(t=Math.ceil(t/1024)),this.lsStatus=[i,t]}setLs(e,t){this.clientInfo.isSupportLS&&(this.beforeOpLs("s",e,t),window.localStorage.setItem(e,t))}removeLs(e){this.clientInfo.isSupportLS&&(this.beforeOpLs("r",e),window.localStorage.removeItem(e))}getLs(e,t){if(!this.clientInfo.isSupportLS)return;let i=window.localStorage.getItem(e);return t?V(i):i}iterateLsKeys(e){let t=localStorage.length,i=new Set;for(let e=0;e<t;e++)i.add(localStorage.key(e));i.forEach((t=>{t&&e(t)}))}batchGetLs(e){let t={};if(!this.clientInfo.isSupportLS)return t;let i=window.localStorage;return e.forEach((([e,n])=>{let r=i[e];r=q(r,n),t[e]=r})),t}checkLsSupport(){if(Storage&&localStorage){try{localStorage.setItem("store_test","1"),localStorage.getItem("store_test"),localStorage.removeItem("store_test")}catch(e){return!1}return!0}return!1}getUrlSearchObject(e){let t=document.location.search.replace("?",""),i=this.mapQuerys2Object(t)||{};return e?i[e]:i}mapQuerys2Object(e){let t={},i=e.split("&")||[];for(let e=0;e<i.length;e++){let n=i[e].split("=");n.length>1&&(t[n[0]]=n[1])}return t||{}}shoudleSendBeacon(e=!1){if(!this.clientInfo.isSupportSendBeacon)return!1;return e||this.clientInfo.isTripApp||this.clientInfo.isCtripApp||this.clientInfo.isOnline}checkIsSupportSendBeacon(e){return"object"==typeof navigator&&"function"==typeof navigator.sendBeacon&&!e.isFile&&!/tripPal|AliApp|CBP(IOS)?_Wireless|MinxingMessenger|seeyonCordova/i.test(navigator.userAgent)}multiGetCookie(e){let t={},i=this.getCookieAll();return e.forEach((([e,n])=>{let r=i[e];r=q(r,n),t[e]=r})),t}getCookieAll(){let e=document.cookie;if(!e)return{};let t={};return e.split("; ").forEach((e=>{let i=e.indexOf("="),n=e.substring(0,i),r=e.substring(i+1);t[n]=r})),t}removeCookie(e){let t=this.getRootDomain();document.cookie=`${e}=;domain=${t};expires=Thu, 01 Jan 1970 00:00:01 GMT;`}getRootDomain(){let e="",t="_bfp=cookie",i=location.hostname.split(".");for(let n=i.length-1;n>=0;n--)if(e="."+i.slice(n).join("."),document.cookie=`${t};domain=${e};`,document.cookie.indexOf(t)>-1)return document.cookie=`${t.split("=")[0]}=;domain=${e};expires=Thu, 01 Jan 1970 00:00:01 GMT;`,e;return e}async loadScript(e,t,i=!0){if(!e)return;let n=!1,r=document.createElement("script");r.type="text/javascript",r.async=!0,r.setAttribute("crossorigin","anonymous"),r.onload=r.onreadystatechange=function(e){n||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(this.onload=this.onreadystatechange=null,n=!0,t&&t(e))},i&&(e=e+"?v="+K()),r.src=e;let s=document.getElementsByTagName("body")[0];if(s)s.appendChild(r);else{let e=document.getElementsByTagName("head")[0];null==e||e.appendChild(r)}}getMiniEnv(){if(window._mpType)return window._mpType;if(window.cmpBridge&&"function"==typeof window.cmpBridge.isMiniProgram)return window.cmpBridge.isMiniProgram();let e=Ct();return e||void 0}ubtChecking(e,t=""){let i;try{if(!this.shouldChecking)return;let{backup:n,headers:r,ts:s,queryLen:a}=e,{req:l,type:d,isMagnetSend:u}=n,{context:p,business:h,ubtList:f}=l;if(!p)return;i=r||{};try{let e=f.find((e=>e.type==o.PV)),n={vid:p.vid,sid:p.sid,pvid:p.pvid,cid:p.clientId,pageId:p.pid,env:p.env,ts:s,timezoneOffset:t.length,sendType:d,pageRef:h.attrs.instKey,contextTs:null==e?void 0:e.triggerTs,url:p.url,contextTs_date:null==e?void 0:e.triggerTs,collectReq:t,catHeaders:i};n.tag=JSON.stringify({instKeys:Array.from(U.instMap.keys()),isMagnetSend:u?1:0,hasUrl:p.url?1:0});let r=function(e,t="ubtChecking"){let i=ee(e);return e.isProd?e.isTrip?`${i}//bbzutils.trip.com/${t}`:e.isLAN?`${i}//bbzutils.ctripcorp.com/${t}`:`${i}//bbzutils.ctrip.com/${t}`:`${i}//bbzutils.uat.qa.nt.ctripcorp.com/${t}`}(this.clientInfo);this.request({body:JSON.stringify(n),url:r,headers:{"XUBT-CODE":re(`${n.vid}-${n.sid}-${n.pvid}-${n.ts}`)}},1e4,"include")}catch(e){c.printError("ubtChecking err.",e)}}catch(e){console.log("error: ",e)}return i}getCaptainAppId(){return window.__CORE_SDK__&&window.__CORE_SDK__.AppID?window.__CORE_SDK__.AppID:window.__NEXT_DATA__&&window.__NEXT_DATA__.runtimeConfig&&window.__NEXT_DATA__.runtimeConfig.AppID?window.__NEXT_DATA__.runtimeConfig.AppID:window.__NFES_DATA__&&window.__NFES_DATA__.runtimeConfig&&window.__NFES_DATA__.runtimeConfig.AppID?window.__NFES_DATA__.runtimeConfig.AppID:void 0}getFrameworkTypeVersion(){let e="",t="";return window.__NEXT_DATA__&&window.__NEXT_DATA__.version?(e="N",t=window.__NEXT_DATA__.version):window.__NFES_DATA__&&window.__NFES_DATA__.version&&(e="S",t=window.__NFES_DATA__.version),{frType:e,frVersion:t}}appendReqDataBeforeStringify(e){try{const{type:i,data:n}=e;if(i===o.ERROR){if(n&&(!n.framework&&window.__CORE_SDK__&&window.__CORE_SDK__.framework&&(n.framework=window.__CORE_SDK__.framework),!n.extendedField)){let e={appEnv:G(this.clientInfo)};const t=this.getCaptainAppId();t&&(e.captainAppId=t),n.extendedField=e}if(n&&Object.prototype.hasOwnProperty.call(n,"extendedField")){const e=n.extendedField;if(e&&"object"==typeof e){if(e.appEnv||(e.appEnv=G(this.clientInfo)),!e.captainAppId){const t=this.getCaptainAppId();t&&(e.captainAppId=t)}if(e.captainAppId){var t=window.__NFES_DATA__||window.__NEXT_DATA__||{};t.assetPrefix&&"string"==typeof t.assetPrefix&&(e.nfesResVersion=t.assetPrefix.split("/").pop()),n&&"NFES"===n.framework&&(e.framework="nfes-web-core")}const{frType:i,frVersion:r}=this.getFrameworkTypeVersion();i&&(e.frType=i),r&&(e.frVersion=r),window.__CORE_SDK__&&window.__CORE_SDK__.version&&(e.wcVersion=window.__CORE_SDK__.version)}}}}catch(e){}}getCargoData(e){let t=window.cargo;if(!t)return{};const i=e!==Se.Online?"h5":"";return{ubt_language:t.getLanguage(i),ubt_currency:t.getCurrency(i),ubt_site:t.getSite(),ubt_locale:t.getLocale(i)}}setCommon(e){try{var t;window.__NEXT_DATA__&&window.__NEXT_DATA__.version?(e.frType="N",e.frVersion=window.__NEXT_DATA__.version):window.__NFES_DATA__&&window.__NFES_DATA__.version&&(e.frType="S",e.frVersion=window.__NFES_DATA__.version),window.__CORE_SDK__&&window.__CORE_SDK__.version&&(e.wcVersion=window.__CORE_SDK__.version),null!==(t=window.xtaro_global_config_data)&&void 0!==t&&t.xtaro_config&&(e.xTaroUserVersion=window.xtaro_global_config_data.xtaro_config.xTaroUserVersion,e.xTaroVersion=window.xtaro_global_config_data.xtaro_config.xTaroVersion,e.xTaroH5BuildUrl=window.xtaro_global_config_data.xtaro_config.h5BuildUrl)}catch(e){}}cleanInvalidLsKeys(){this.iterateLsKeys((e=>{{if(!e||!T.UBTACTIVE_LSKEY.test(e))return;let t=this.getLs(e);(!t||isNaN(Number(t))||Date.now()-Number(t)>=5e3)&&this.removeLs(e)}}))}};i.client=i.webClient=new At,i.clientType=i.client.clientType,i.clientInfo=i.client.clientInfo,i.watcher=i.client.watcher})();